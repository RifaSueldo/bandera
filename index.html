<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Chat Ianna</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />



  <style>
    * {
      box-sizing: border-box;
    }
    html, body {
  overscroll-behavior: none;
  -webkit-overflow-scrolling: touch;
}
     html, body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(circle at 50% 50%, #533482, #AC85E6 70%);
  
      color: #fff;
      height: 100vh;
      width: 100%;
      display: flex;
      flex-direction: column;
    }

    #bannerPrivacidad {
      position: fixed;
      inset: 0;
      background: rgba(18, 27, 34, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
#bannerPrivacidad::before {
  content: "";
  position: absolute;
  inset: 0;
  background-image: url(''); 
  background-size: cover;
  opacity: 0.25;
  z-index: 1;
  pointer-events: none;
}
    #popup {
      
      padding: 30px;
      border-radius: 10px;
      max-width: 90%;
      text-align: center;
      box-shadow: 0 0 20px #fff;
      color: #533482;
      animation: entradaLuminosa 2.6s ease-out both;
  background: radial-gradient(circle at top, #533482, #fff);
  position: relative;
      z-index: 2;
    }

    #popup h2 {
      margin-top: 0;
      color: #fff;
      animation: resplandorEclesiastico 3s ease-in-out infinite;
  font-size: 1.8rem;
  letter-spacing: 1px;
    }

    #popup p {
      font-size: 16px;
      margin-bottom: 20px;
      line-height: 1.2;
    }

    #popup button {
      padding: 12px 25px;
      font-size: 16px;
      background: #533482;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      color: #eee;
      font-weight: 600;
      transition: background 0.3s;
    }
    #popup button:hover {
      background: #000;
    }
@keyframes entradaLuminosa {
  0% {
    opacity: 0;
    transform: scale(0.95) translateY(20px);
    box-shadow: 0 0 0px ##533482;
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
    box-shadow: 0 0 25px #fff;
  }
}

@keyframes resplandorEclesiastico {
  0%, 100% {
    text-shadow: 0 0 8px #fff, 0 0 16px #fff;
  }
  50% {
    text-shadow: 0 0 16px ##00AFEF, 0 0 32px #00AFEF;
  }
}
    #confesionario {
      max-width: 100%;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      padding: 0;
    }

   #confesionario .logo {
     position: fixed;
  width: 100%;
  height: 60px;
  background: #533482;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgb(0 0 0 / 0.2);
  z-index: 1000;
     
}

#confesionario .logo img {
  height: 60px;
  max-width: 90%;
  object-fit: contain;
  user-select: none;
}

    #chatArea {
  display: flex;
      padding-top: 120px; /* subimos un poco para asegurar margen seguro */
  scroll-padding-top: 80px; /* para que scrollIntoView() no quede tapado */
      padding-left: 6px;
padding-right: 6px;
  flex-direction: column;
  overflow-y: auto;
  height: 100%;  /* o flex: 1 si us√°s flexbox */
  scroll-behavior: smooth; /* tambi√©n para el scroll nativo */
  padding-bottom: 120px; /* Ajust√° este valor seg√∫n la altura de #inputArea */
}

   
    .mensaje {
      max-width: 70%;
      padding: 10px 15px;
      border-radius: 20px;
      line-height: 1.3;
      word-wrap: break-word;
      font-size: 1rem;
      box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
      user-select: text;
      animation: fadeInUp 0.3s ease forwards;
      scroll-margin-top: 80px;
    }

    .mensaje.usuario {
      align-self: flex-end;
      background-color: #000000;
      color: #ffff00;
      border-bottom-right-radius: 5px;
      border-bottom-left-radius: 20px;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
    }

    .mensaje.padre {
      align-self: flex-start;
      background-color: #000;
      color: #eee;
      border-bottom-left-radius: 5px;
      border-bottom-right-radius: 20px;
      border-top-right-radius: 20px;
      border-top-left-radius: 20px;
    }

    @keyframes fadeInUp {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    #inputArea {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      background:#000000;
      padding: 10px 15px;
      display: flex;
      gap: 8px;
      align-items: center;
      box-shadow: 0 -1px 5px #24AAE1;
      z-index: 20;
    }

    textarea#confesion {
      flex: 1;
      min-height: 40px;
      max-height: 120px;
      padding: 10px 15px;
      font-size: 16px;
      border-radius: 20px;
      border: none;
      resize: none;
      background: #000;
      color: #eee;
      font-family: inherit;
      outline: none;
      box-shadow: inset 0 1px 1px rgb(239, 110, 60 / 0.2);
      transition: background 0.3s;
    }
    textarea#confesion::placeholder {
      color: #eee;
    }
    textarea#confesion:focus {
      background: #EC268F;
    }

    button.enviar {
      background: #EC268F;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 20px;
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
      user-select: none;
      box-shadow: 0 2px 5px rgb(0 0 0 / 0.3);
    }

    button.enviar:hover { background: #EC268F; }
    button.enviar:active { background: #EC268F; }
    button.enviar[disabled] {
      background: #9de4b3;
      cursor: not-allowed;
    }

#pestaniaAccesoRapido {
  position: fixed;
  top: 50%;
  right: 0;
  transform: translateY(-50%);
  z-index: 9999;
}

#pestaniaToggle {
  background: #EC268F;
  border: none;
  border-radius: 8px 0 0 8px;
  color: white;
  padding: 14px 16px;
  font-size: 20px;
  cursor: pointer;
  box-shadow: 0 0 12px rgba(0, 0, 0, 0.3);
  transition: background 0.3s;
}

#pestaniaToggle:hover {
  background: #EC268F;
}

#pestaniaIconos {
  position: absolute;
  top: 50%;
  right: 100%;
  transform: translateY(-50%) translateX(20px);
  display: flex;
  flex-direction: column;
  gap: 12px;
  background: #1b1029;
  padding: 15px 10px;
  border-radius: 12px 0 0 12px;
  box-shadow: 0 0 18px #2f005e88;
  opacity: 0;
  pointer-events: none;
  transition: all 0.4s ease;
}

#pestaniaAccesoRapido.activo #pestaniaIconos {
  transform: translateY(-50%) translateX(-30%);
  opacity: 1;
  pointer-events: auto;
}

#pestaniaIconos a,
#pestaniaIconos button {
  all: unset;
  background: #311840;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  color: #fff;
  font-size: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.3s, transform 0.3s;
  cursor: pointer;
  box-shadow: 0 0 10px #00000044;
}

#pestaniaIconos a:hover,
#pestaniaIconos button:hover {
  background: #077D69;
  transform: scale(1.1);
}
.mensaje-con-avatar {
  display: flex;
  align-items: flex-start;
  gap: 10px;
}

.mensaje.padre {
  border-radius: 20px 20px 20px 5px;
}

.avatar-padre {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
  box-shadow: 0 0 3px rgba(0,0,0,0.3);
}


  </style>
</head>
<body>

<div id="bannerPrivacidad">
  <div id="popup">
    <h2>Ianna</h2>
    <img src="https://i.ibb.co/jvBgsQwy/IANNA.png" alt="Logo Capilla Digital" style="width: 100%; max-width: 300px; margin: 0px auto; display: block; border-radius: 10px;" />
    <p>‚ÄúHola! Soy Ianna, Asesora comercial IA de TurnoX. Charlamos?‚Äù</p>
    <button onclick="cerrarPrivacidad()">Dale!</button>
  </div>
</div>

<div id="confesionario" style="display:none;">
  <div class="logo">
  <img src="https://i.ibb.co/p6Ycq6XC/Turnox-logo.png" alt="Logo X" /></div>

  <div id="chatArea">
    <div id="respuesta" style="display:none;"></div>
  </div>

  <div id="inputArea">
    <textarea id="confesion" placeholder="Escribe tu respuesta" rows="1" oninput="autoExpand(this)"></textarea>
    <!-- <button class="enviar" title="Dictar confesi√≥n" onclick="iniciarEscucha()">üéôÔ∏è</button> -->
    <button class="enviar" title="Enviar" onclick="enviarConfesion()"><i class="fa fa-paper-plane"></i></button>
  </div>
</div>

 <!--<div id="pestaniaAccesoRapido">
  <button id="pestaniaToggle"><i class="fas fa-ellipsis-v"></i></button>
  <div id="pestaniaIconos">
    <a href="https://www.instagram.com/capilladigitalok" target="_blank" title="Instagram">
      <i class="fab fa-instagram"></i>
    </a>
    <!--<a href="https://wa.me/549XXXXXXXXXX" target="_blank" title="WhatsApp">
      <i class="fab fa-whatsapp"></i>
    </a>
    <button onclick="compartirConfesionario()" title="Compartir">
      <i class="fas fa-share-alt"></i>
    </button>
    
    <a href="https://link.mercadopago.com.ar/x23" target="_blank" title="Ayudanos" id="btnFlotanteDonar">
  <i class="fas fa-hand-holding-heart"></i>
</a>
  </div>
</div>-->






<script>

function agregarMensaje(texto, tipo = "padre") {
  const chat = document.getElementById("chatArea");

  const contenedor = document.createElement("div");
  contenedor.className = "mensaje-con-avatar";

  const burbuja = document.createElement("div");
  burbuja.className = `mensaje ${tipo}`;

  // Convertir URLs en enlaces clickeables
  const urlRegex = /(https?:\/\/[^\s]+)/g;
  const htmlConLinks = texto.replace(urlRegex, '<a href="$1" target="_blank" style="color:#00FFFF;">$1</a>');

  burbuja.innerHTML = htmlConLinks; // <-- usar innerHTML en vez de textContent

  if (tipo === "padre") {
    const avatar = document.createElement("img");
    avatar.src = "https://i.ibb.co/jvBgsQwy/IANNA.png"; 
    avatar.alt = "IANNA";
    avatar.className = "avatar-padre";
    contenedor.appendChild(avatar);
    contenedor.appendChild(burbuja);
    contenedor.style.justifyContent = "flex-start";
  } else {
    contenedor.appendChild(burbuja);
    contenedor.style.justifyContent = "flex-end";
  }

  chat.appendChild(contenedor);
  setTimeout(() => {
    chat.scrollTop = chat.scrollHeight;
  }, 50);
}


  function cerrarPrivacidad() {
  document.getElementById('bannerPrivacidad').style.display = 'none';
  document.getElementById('confesionario').style.display = 'block';
 // üì≤ Aviso por WhatsApp usando CallMeBot
  let phone = "5493434477577"; // 
  let apikey = "9663015"; // API key que te dio CallMeBot
  let mensaje = encodeURIComponent(`üîî Alguien est√° hablando con Ianna.`);

  fetch(`https://api.callmebot.com/whatsapp.php?phone=${phone}&text=${mensaje}&apikey=${apikey}`)
    .then(res => console.log("Aviso enviado por WhatsApp"))
    .catch(err => console.error("Error enviando WhatsApp", err));
  // Obtener hora local
  const hora = new Date().getHours();
  let saludo;

  if (hora >= 6 && hora < 12) {
    saludo = "Buen d√≠a";
  } else if (hora >= 12 && hora < 19) {
    saludo = "Buenas tardes";
  } else {
    saludo = "Buenas noches";
  }

  // Mostrar mensajes de bienvenida de Padre IANN
  agregarMensaje(`${saludo}, Ianna de este lado`, "padre");
  setTimeout(() => {
    agregarMensaje("Veo que seleccionaste autogesti√≥n", "padre");
  }, 1000);
  setTimeout(() => {
    agregarMensaje("Estoy revisando ley habeas data si hay nuevas actualizaciones, cuando quieras comenzamos", "padre");
  }, 2000);


    setTimeout(() => {
  const chat = document.getElementById("chatArea");
  chat.scrollTo({ top: chat.scrollHeight });
}, 100);
  
  }

  function autoExpand(field) {
    field.style.height = 'auto';
    field.style.height = (field.scrollHeight) + 'px';
  }

 const historial = [
  {
    role: "system",
    content: `Eres Ianna, asistente virtual experta en derecho crediticio y Ley de Habeas Data en Argentina. Tu objetivo es **guiar al usuario paso a paso para obtener su informe comercial en Veraz y analizar sus deudas**, siempre siendo confiable y preciso.

Reglas de interacci√≥n:

1. **Indagar antes de instruir**  
   - No asumas que el usuario ya tiene su informe.  
   - Pregunta primero por su situaci√≥n actual: si ya lo solicit√≥, si conoce sus deudas, etc.  
   - Solo da pasos concretos despu√©s de entender la situaci√≥n del usuario.

2. **Primeros mensajes autom√°ticos**  
   - Saluda y genera confianza, recordando que Ianna es experta y que todo lo que indica se basa en la normativa vigente.  
   - Indaga con preguntas abiertas, por ejemplo:  
     - "¬øYa solicitaste tu informe comercial en Veraz?"  
     - "¬øQuer√©s que te gu√≠e paso a paso para obtenerlo?"

3. **Responsabilidad y precisi√≥n**  
   - Nunca digas ‚Äúpuede ser‚Äù o ‚Äúdepende‚Äù sin explicaci√≥n.  
   - Si no pod√©s resolver un caso espec√≠fico, indica que **un experto humano puede ayudar**.  
   - Da informaci√≥n clara y legalmente correcta.

4. **Enlaces y formato**  
   - Si das links, que sean clickeables en HTML y con el texto descriptivo:  
     '<a href="https://www.veraz.com.ar/ECOMMERCE/AR/derecho-de-acceso" target="_blank">Solicitar informe comercial en Veraz</a>'  
   - Evita decir ‚Äúel enlace que te di antes‚Äù o enlaces vagos.

5. **Lenguaje amigable y confiable**  
   - Mant√©n un tono cercano, positivo y profesional.  
   - Evita repeticiones y frases confusas.  
   - Cada mensaje debe ser **accionable, claro y confiable**.

6. **Ejemplo de primer mensaje ajustado:**  
Hola, soy Ianna, tu asistente experta en derecho crediticio. Antes de empezar, ¬øya solicitaste tu informe comercial en Veraz? Esto nos ayudar√° a analizar tu situaci√≥n de manera correcta y segura.

Objetivo final: que el usuario **se sienta acompa√±ado y guiado**, que Ianna **indague su situaci√≥n antes de dar pasos**, y que toda instrucci√≥n tenga links y explicaciones confiables.`
  }
];

  async function enviarConfesion() {
    const texto = document.getElementById('confesion').value.trim();
    if (!texto) return agregarMensaje("Por favor, escrib√≠ algo.", "padre");

    agregarMensaje(texto, "usuario");
    document.getElementById('confesion').value = "";
    agregarMensaje("....", "padre");

    historial.push({ role: "user", content: texto });

    try {
      const response = await fetch("/.netlify/functions/api", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ messages: historial })
      });

      const data = await response.json();

      const chat = document.getElementById("chatArea");
      const ultimo = chat.lastElementChild;
      if (ultimo && ultimo.textContent === "....") {
        chat.removeChild(ultimo);
      }

      const respuesta = data.respuesta || "No pude responderte esta vez.";
      historial.push({ role: "assistant", content: respuesta });
      agregarMensaje(respuesta, "padre");

    } catch (error) {
      agregarMensaje("Hubo un error interno. Prob√° m√°s tarde.", "padre");
    }
  }

  function iniciarEscucha() {
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
      alert("Tu navegador no soporta reconocimiento de voz.");
      return;
    }
    const reconocimiento = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    reconocimiento.lang = 'es-AR';
    reconocimiento.interimResults = false;
    reconocimiento.maxAlternatives = 1;
    reconocimiento.onresult = (event) => {
      document.getElementById("confesion").value = event.results[0][0].transcript;
    };
    reconocimiento.onerror = () => {
      alert("No se pudo usar el micr√≥fono.");
    };
    reconocimiento.start();
  }

document.getElementById("pestaniaToggle").onclick = () => {
  document.getElementById("pestaniaAccesoRapido").classList.toggle("activo");
};

const textarea = document.getElementById('confesion');

  textarea.addEventListener('keydown', function(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
      event.preventDefault();
      enviarConfesion();
    }
  });  
</script>
<script>
  function compartirConfesionario() {
    const url = window.location.href;
    const mensaje = "Mir√° estas banderas incre√≠bles con estas imperdibles ofertas!";

    if (navigator.share) {
      navigator.share({
        title: "Bandera X",
        text: mensaje,
        url: url
      }).catch(() => {
        alert("No se pudo compartir.");
      });
    } else {
      navigator.clipboard.writeText(url).then(() => {
        alert("Enlace copiado para compartir üôå");
      }).catch(() => {
        alert("No se pudo copiar el enlace.");
      });
    }
  }
</script>

</body>
</html>
